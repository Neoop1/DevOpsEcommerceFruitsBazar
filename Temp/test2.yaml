apiVersion: apps/v1
kind: Deployment
metadata:
  name: webserver
  labels:
    run: webserver
spec:
  replicas: 1
  selector:
    matchLabels:
      app: webserver
  template:
    metadata:
      labels:
        app: webserver
    spec:
      securityContext:
        # Set this to any valid GID, and two things happen:
        #   1) The volume "content-from-git" is group-owned by this GID.
        #   2) This GID is added to each container.
        fsGroup: 101
      volumes:
        - name: web-data
          emptyDir: {}
      containers:
        - name: git-sync
          image: registry.k8s.io/git-sync/git-sync:v4.2.3
          imagePullPolicy: Always
          args:
            - --repo=https://github.com/Neoop1/DevOpsEcommerceFruitsBazar.git
            - --branch=wwwdata
            - --depth=1
            - --period=60s
            - --link=html
            - --root=/git
          volumeMounts:
            - name: web-data
              mountPath: /git
        - name: nginx-webserver
          image: richarvey/nginx-php-fpm
          volumeMounts:
           - name: web-data
             mountPath: /web
             readOnly: true
          env:
          - name: MARIADB_HOST
            value: mysqlserver

          - name: MARIADB_DATABASE
            value: ecommerce

          - name:  MARIADB_PORT
            value: "3306"

          - name: MARIADB_USER
            valueFrom:
              secretKeyRef:
                name: mariadb-secret
                key: mariadb-username
                
          - name: MARIADB_PASSWORD
            valueFrom:
              secretKeyRef:
                name: mariadb-secret
                key: mariadb-password
           - name: WEBROOT
             value : '/web/html'
          #- name: SSH_KEY
          #  value: '<YOUR_KEY_HERE>'
          #- name: GIT_REPO
          #  value: 'https://github.com/Neoop1/DevOpsEcommerceFruitsBazar.git'
          #- name: GIT_EMAIL
          #  value: '<YOUR_EMAIL>'
          #- name: GIT_NAME
          #  value: '<YOUR_NAME>'
          # - name:  GIT_BRANCH
          #   value: 'wwwdata"
          ports:
           - name: webserver
             containerPort: 80